<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<script src="https://d3js.org/d3.v3.min.js"></script>
<style type="text/css">
@media screen and (min-width: 500px) and (min-width: 500px){
   body {
      width:1200px;
      height: 800px;
      font: 11px sans-serif;
   }
}

.heading{
    position:absolute;
    left:450px;
    font: 40px sans-serif;
    color:rgb(143, 111, 22);
}
/* On mouse hover, lighten state color */
path:hover {
    fill-opacity: .7;
}

/* Style for Custom Tooltip */
div.tooltip {
 	position: absolute;
	text-align: center;
	width: auto;
	height: auto;
	padding: 4px;
	font: 18px sans-serif;
	background: white;
	border: 0px;
	border-radius: 8px;
	pointer-events: none;
}

/* Legend Font Style */


/* Legend Position Style */
.legend {
    position:absolute;
    left:800px;
    top:350px;
}
.textentry {
    position  :absolute;
    top:       500px;  /* I usually locate relative to top  */
    left:      1200px; /* left corner of container (screen) */
    height:    20px;
    width: 300px;
    padding: 12px 20px;
    margin: 8px 0;
    display: inline-block;
    border: 2px solid #ccc;
    border-radius: 4px;
    box-sizing: border-box;
    font: 16px sans-serif;
        /*  often useful to keep screen orderly */
  }
  .speciesentry {
    position  :absolute;
    top:       480px;  /* I usually locate relative to top  */
    left:      1200px; /* left corner of container (screen) */
    height:    8px;  /*  often useful to keep screen orderly */
    font: 18px sans-serif;
    font-weight: bold;
  }
  .notify {
    position  :absolute;
    top:       530px;  /* I usually locate relative to top  */
    left:      1200px; /* left corner of container (screen) */
    height:    8px;  /*  often useful to keep screen orderly */
    font: 16px sans-serif;
    font-weight: bolder;
  }
  }

</style>
</head>

<body>
    <h2 class="heading">Location-Wise Visualization of Cactus</h2>

    <label for="species" class="speciesentry">Search Species: </label>
    <input  type="text" id="species" class="textentry" onchange="markLocationOnMap(this.value);marklocationrext(this.value)" value="Please Enter the Species Name";/>
    <p id='not' class="notify"></p>
    <h3><a href="choropleth.html">Cactus Population Based Choropleth</a></h3>
    <script type="text/javascript">

    /*  This visualization was made possible by modifying code provided by:

    Scott Murray, Choropleth example from "Interactive Data Visualization for the Web"
    https://github.com/alignedleft/d3-book/blob/master/chapter_12/05_choropleth.html

    Malcolm Maclean, tooltips example tutorial
    http://www.d3noob.org/2013/01/adding-tooltips-to-d3js-graph.html

    Mike Bostock, Pie Chart Legend
    http://bl.ocks.org/mbostock/3888852  */


    //Width and height of map
    var width = 1420;
    var height = 800;

    // D3 Projection
    var projection = d3.geo.albers()
        .translate([width / 2, height / 2]) // translate to center of screen
        .scale([400]); // scale things down so see entire US

    // Define path generator
    var path = d3.geo.path() // path generator that will convert GeoJSON to SVG paths
        .projection(projection); // tell path generator to use albersUsa projection


    // Define linear scale for output
    var color = d3.scale.linear()
        .range(["rgb(213,222,217)", "rgb(69,173,168)", "rgb(84,36,55)", "rgb(217,91,67)"]);

    var legendText = ["Cities Lived", "States Lived", "States Visited", "Nada"];

    //Create SVG element and append map to the SVG
    var svg = d3.select("body")
        .append("svg")
        .attr("width", width)
        .attr("height", height);

    // Append Div for tooltip to SVG
    var div = d3.select("body")
        .append("div")
        .attr("class", "tooltip")
        .style("opacity", 0);
    var datt={}
    // Load in my states data!
    datt=d3.csv("test.csv", function(data) {
        color.domain([0, 1, 2, 3]); // setting the range of the input data

        // Load GeoJSON data and merge with states data
        // d3.json("us-states.json", function(json) {
        d3.json("americas.json", function(json) {

            // Loop through each state data value in the .csv file
            for (var i = 0; i < data.length; i++) {

                // Grab State Name
                var dataState = data[i].state;

                // Grab data value
                var dataValue = data[i].visited;

                // Find the corresponding state inside the GeoJSON
                for (var j = 0; j < json.features.length; j++) {
                    var jsonState = json.features[j].properties.name;

                    if (dataState == jsonState) {

                        // Copy the data value into the JSON
                        json.features[j].properties.visited = dataValue;

                        // Stop looking through the JSON
                        break;
                    }
                }
            }

            // Bind the data to the SVG and create one path per GeoJSON feature
            svg.selectAll("path")
                .data(json.features)
                .enter()
                .append("path")
                .attr("d", path)
                .style("stroke", "#fff")
                .style("stroke-width", "1")
                .style("fill", function(d) {

                    // Get data value
                    var value = d.properties.visited;

                    if (value) {
                        //If value exists…
                        return color(value);
                    } else {
                        //If value is undefined…
                        return "rgb(213,222,217)";
                    }
                });

            // Map the cities I have lived in!
            datt=d3.csv("dataset.csv", function(data) {


                for (i = 0; i < data.length; i++) {
                    //console.log(data[i]);
                    datt[data[i].Species.replace(/ /g, "_").toLowerCase()]=data[i].Description;
                    }
                svg.selectAll("circles")
                    .data(data)

                    .enter()
                    .append("image")
                    .filter(function(d){ return d.TRUE ==1; })
                    .attr("id", function(d) {
                        return d.Species.replace(/ /g, "_").toLowerCase();})
                    .attr('xlink:href', 'cactusflower.png')
                    .attr("x", function(d) {
                        // try {
                            return projection([d.lon, d.lat])[0]-20;
                        // } catch(e) {
                        //     return 0;
                        // }
                    })
                    .attr("y", function(d) {
                        // try {
                            return projection([d.lon, d.lat])[1]-20;
                        // } catch(e) {
                        //     return 0;
                        // }
                    })

                    .attr('width', 40)
                    .attr('height', 40)


                    // Modification of custom tooltip code provided by Malcolm Maclean, "D3 Tips and Tricks"
                    // http://www.d3noob.org/2013/01/adding-tooltips-to-d3js-graph.html
                    .on("click",function(d){
                    	if (d.Predict==0){
                    		alert("This is Flower");
                    	}
                    	else{
                    		alert("This is cactus");
                    	}

                    })

                    .on("mouseover", function(d) {


                        div.transition()
                            .duration(200)
                            .style("opacity", .9);
                        div.text("Location: " + d.place)

                            .style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY - 28) + "px");
                        div.html("<p>Species: " + d.Species + "</p><p>Location: " + d.place + "</p></h1><ahref='http://en.wikipedia.org/wiki/Tombouctou_Region'><img  src=" + d.imag + " style=width:100px;height:120px; ></ahref><p id="+"demo"+"></p> ");
                        if (d.Description!=""){
                            document.getElementById("demo").innerHTML="Attributes"+d.Description;
                            //console.log(typeof d.Description);
                        }
                    })

                    // fade out tooltip on mouse out
                    .on("mouseout", function(d) {
                        div.transition()
                            .duration(500)
                            .style("opacity", 0);
                    });
                    svg.selectAll("circles")
                    .data(data)

                    .enter()
                    .append("image")
                    .attr("class","circle_")
                  .filter(function(d){ return d.TRUE ==0; })
                  .attr("id", function(d) {
                        return d.Species.replace(/ /g, "_").toLowerCase();})
                  .attr('xlink:href', 'cactus.svg')
                    .attr("x", function(d) {
                        // try {
                            return projection([d.lon, d.lat])[0]-20;
                        // } catch(e) {
                        //     return 0;
                        // }
                    })
                    .attr("y", function(d) {
                        // try {
                            return projection([d.lon, d.lat])[1]-20;
                        // } catch(e) {
                        //     return 0;
                        // }
                    })

                    .attr('width', 40)
                    .attr('height', 40)


                     .on("click",function(d){
                    	if (d.Predict==0){
                    		alert("This is Classified as Cactus with Flower");
                    	}
                    	else{
                    		alert("This is Classified as Cactus without Flowers");
                    	}

                    })
                    .on("mouseover", function(d) {
                        div.transition()
                            .duration(200)
                            .style("opacity", .9);
                        div.text("Location: " + d.place)

                            .style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY - 28) + "px");
                        div.html("<p>Species: " + d.Species + "</p><p>Location: " + d.place + "</p></h1><ahref='http://en.wikipedia.org/wiki/Tombouctou_Region'><img  src=" + d.imag + " style=width:100px;height:120px; ></ahref><p id="+"demo"+"></p> ");
                        if (d.Description!=""){
                            document.getElementById("demo").innerHTML="Attributes"+d.Description;
                            //console.log(typeof d.Description);
                        }
                    })
                    .on("mouseout", function(d) {
                        div.transition()
                            .duration(500)
                            .style("opacity", 0);
                    })

             return datt;});

            // Modified Legend Code from Mike Bostock: http://bl.ocks.org/mbostock/3888852

        });

    return datt;});
    var datt=d3.csv("dataset.csv", function(data) {

                var datt={};

                for (i = 0; i < data.length; i++) {
                    //console.log(data[i]);
                    datt[data[i].Species.replace(/ /g, "_").toLowerCase()]=data[i].Description;
                    }
                    });






    console.log(datt);
    /*
    Update the size and color of the marker circle on map.
    */
    function markLocationOnMap(species_name,datt) {
        var elementId = "#".concat(species_name.replace(/ /g, "_").toLowerCase());
        //console.log(elementId)
        var circle = svg.selectAll(elementId);
        //console.log(circle)
        //var currentwidth = circle.attr("width");
        //console.log(currentwidth)
        //var currentheight = circle.attr("height");
        //var newwidht = currentwidth * 2;
       // var newheight=currentheight*2;
        console.log('here')
       //Sconsole.log(d)
        var l= (circle[0].length)

        if (l==0){
            console.log('noti')

            d3.select("p").text("Please check the Spelling")
            .transition()
            .duration(3000)
            .transition()
            .duration(3000)
            .text("")
            return
        }



        circle
            .transition()
            .duration(1500)
            .attr('width', 80)
            .attr('height', 80)
            .transition()
            .duration(1500)
            .attr('width', 40)
            .attr('height', 40) ;

        var elementId =" "




    }
    function marklocationrext(species_name){
    }




    </script>
</body>
</html>
